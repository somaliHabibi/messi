<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Messi vs Ommak - Who Will Win?</title>
  <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>
  <style>
    body {
      background-color: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    button {
      margin: 10px;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    textarea {
      width: 90%;
      height: 100px;
      margin-top: 10px;
      border-radius: 8px;
      padding: 10px;
      font-size: 14px;
    }
    input[type="text"] {
      width: 60%;
      padding: 8px;
      font-size: 14px;
      border-radius: 8px;
      margin: 5px;
    }
    .encrypt { background-color: #1e90ff; color: white; }
    .decrypt { background-color: #ff4d4d; color: white; }
    .copy { background-color: #00cc66; color: white; }
    .storage { background-color: #888; color: white; }
  </style>
</head>
<body>
  <h1>🏆 Messi vs Ommak - Who Will Win?</h1>

  <input type="text" id="tag" placeholder="Goal nickname (tag)">
  <br>
  <textarea id="input" placeholder="Paste your URL or encrypted stuff here..."></textarea>
  <br>

  <button class="encrypt" onclick="encryptUrl()">🧠 Messi Makes a Move</button>
  <button class="decrypt" onclick="decryptUrl()">👵 Ommak Counters</button>
  <button class="copy" onclick="copyOutput()">🗌 VAR Copy Decision</button>
  <button class="storage" onclick="showSaved()">⚽ Replay All Moments</button>

  <h3>Result:</h3>
  <textarea id="output" readonly></textarea>

  <script>
    let aesKey;
    const fixedIv = CryptoJS.enc.Utf8.parse('thisIsAFixedIV123'); // 16 bytes

    function deriveKey(passphrase) {
      const salt = CryptoJS.enc.Utf8.parse('messivsommaksalt');
      aesKey = CryptoJS.PBKDF2(passphrase, salt, {
        keySize: 256 / 32,
        iterations: 1000
      });
    }

    function encryptUrl() {
      if (!aesKey) return alert("Passphrase not set!");
      const url = document.getElementById('input').value;
      const tag = document.getElementById('tag').value || 'Untitled';
      if (!url) return alert("Paste something first!");
      try {
        const encrypted = CryptoJS.AES.encrypt(url, aesKey, { iv: fixedIv }).toString();
        localStorage.setItem(tag, encrypted);
        document.getElementById('output').value = `Tag: ${tag}\nEncrypted:\n${encrypted}`;
      } catch (e) {
        document.getElementById('output').value = 'Encryption error: ' + e.message;
      }
    }

    function decryptUrl() {
      if (!aesKey) return alert("Passphrase not set!");
      const data = document.getElementById('input').value;
      if (!data) return alert("Paste encrypted stuff first!");
      try {
        const decrypted = CryptoJS.AES.decrypt(data, aesKey, { iv: fixedIv }).toString(CryptoJS.enc.Utf8);
        document.getElementById('output').value = decrypted || 'Nothing decrypted';
      } catch (e) {
        document.getElementById('output').value = 'Invalid encrypted input';
      }
    }

    function copyOutput() {
      const out = document.getElementById('output');
      out.select();
      document.execCommand('copy');
      alert("VAR copied to clipboard!");
    }

    function showSaved() {
      const keys = Object.keys(localStorage);
      if (!keys.length) return alert("No recorded goals.");
      let log = '';
      keys.forEach(tag => {
        log += `\n\n🎥 ${tag}:\n${localStorage.getItem(tag)}`;
      });
      document.getElementById('output').value = log.trim();
    }

    window.onload = () => {
      const pass = prompt("🔐 Enter your secret key/passphrase:");
      if (!pass) {
        alert("You need a passphrase to use the app!");
      } else {
        deriveKey(pass);
        console.log("Key derived.");
      }
    };
  </script>
</body>
</html>
